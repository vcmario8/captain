# 大厂八股——分布式共识算法 raft

## 一、为什么需要分布式共识？

大规模软件系统中，单点问题有比较大的稳定性隐患；一般通过机器冗余来解决单点问题。
机器冗余就要解决机器之间数据一致性问题，一致性算法允许一组机器像一个整体一样工作，即使其中一些机器出现问题也能够继续工作。
因此一致性算法再大规模软件系统中非常重要，raft 就是一种一致性算法。

## 二、raft 是什么?

通过选举一个 leader，给 leader 赋予管理复制日志的责任来实现分布式一致性。

## 三、Raft 3 个关键技术：领导选举、日志复制、安全性

### 关键技术 1：选举

选举部分只需要关注4个关键概念就行了：
1）角色，领导者（leader），跟随者（follower），候选者（candidate）
2）任期，用来投票的依据
3）心跳超时，当心跳超时时，跟随者会变成候选者，随机等待一段时间(150-300ms)后发起投票
4）脑裂，当有两个以上候选者收到的票数相同时，此时无法决策出领导者

### 关键技术 2：日志复制

日志包括（状态机指令，任期号），任期号主要用于对账。leader 接收 client 请求，然后处理请求，最后答复 client；处理请求的过程整体还是 2 阶段，先写日志、再应用到状态机；

### 关键技术 3：安全性

参与选举的 2 个约束：1）提交之前任期内的所有日志；2）包含之前已经提交的所有日志。
详细见图片。