# 面试题：代码为什么要编译才能运行？

粉丝咨询了一个面试问题，代码为什么需要编译？他自己肯定问过大模型了，找我聊可能是想探讨些什么，于是写了这篇笔记。

## 原子能力、组合、抽象，是计算的三个核心要求

它们共同构成了复杂系统设计和问题解决的基础框架。

## cpu 提供原子计算能力，程序提供组合和抽象

cpu 和程序，这两者结合构成了我们现在丰富多彩的应用。

## cpu 架构有 3 个主流：x86、ARM、RISC-V

分别在指令集、硬件结构有差异。cpu 提供的原子能力如：1）单字读、对齐字长；2）RMW（读改写）、CAS、and/or/add/sub/BTS/BTC 等等。

## 程序将原子计算能力自由编排，对外抽象封装成函数，再由函数组合完成用户需求

程序提供组合、抽象，从事这一工作的人被称为程序员。

### 1. 早期程序员就是面向 cpu 指令集编程（机器语言编程）

利用纸带打孔的方式写程序，每个指令对应 cpu 的运算、跳转，跨模块跳转计算需要人工介入换纸带，流程及其复杂。

### 2. 有些聪明的程序员开始优化这个流程，提出了 mov、add 来替代直接记忆 cpu 指令集

再通过汇编器转换为机器码，这些指令极大提升了代码的可读性，这就是汇编语言。
这两个时期的程序员，都需要精通cpu 架构，比如寄存器分配、内存寻址等。

## 这个时期程序员需要人工将代码翻译成机器指令集，步骤如下

### 1. 预处理：人工展开和替换代码

首先手动展开include和define，将对应文件和值拷贝到源文件。

### 2. 编译：分模块手工翻译代码

每个源文件翻译为汇编代码，最后再由汇编器翻译成机器代码，汇编器将每条汇编代码一一映射成机器代码。

### 3. 链接：人工重定位与符号解析

调用函数跳转后，需要人工计算后续指令的地址并修改，这个过程称为重定位。涉及跨模块调用函数时，需要手动找到外部函数地址并填入调用处，这个过程称之为符号解析。

可以看到预处理、编译、链接的人工操作，效率及其底下，也非常容易错，预处理、编译、链接的自动化将进一步推动编程的发展。

## 随着编译过程的自动化，高级语言就应运而生了

高级语言更贴近人的自然语言，高级语言编写的程序还是要跑在 cpu 上，依旧要经过预处理、编译、链接。

## 编译器解决了高级语言到机器语言的映射问题

程序员承担了自然语言到高级语言的映射工作；这个阶段程序员开始专注需求本身。